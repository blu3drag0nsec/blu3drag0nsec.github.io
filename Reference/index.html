<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>blu3drag0nsec</title>
<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/css/bootstrap.min.css" integrity="sha384-Gn5384xqQ1aoWXA+058RXPxPg6fy4IWvTNh0E263XmFcJlSAwiGgFAW/dAiS6JXm" crossorigin="anonymous">    
</head>
<body>
  
<div class="container">
    <p>Ciphey: sudo docker run -it --rm remnux/ciphey</p>
    
    <p>Python: remote and local process</p>
    <pre><code>from pwn import *
from timeit import default_timer as timer
import math

HOST = "chals.damctf.xyz"
PORT = 30318
p = remote(HOST, PORT)

#p = process("./side-channel.py")\

print(p.recvuntil(b'Password guessing'))
print(p.recvuntil(b'?'))

key = "0123456789abcdef"

passw = ''

for i in range(8):
    
    p.send(b'0\n')
    start = timer()    
    print(p.recvuntil(b'?'))
    end = timer()
    print( (end - start) / 0.1)
    print( int((end - start) / 0.1))
    passw += key[int((end - start) / 0.1)]
    print( passw )

#print(p.recvuntil(b'?'))

for i in range(8):

    p.send("{}\n".format(passw[i]))
    if i >= 7:
        print(p.interactive())
    else:
        print(p.recvuntil(b'?'))
    </code></pre>

        <p> Python: normal requests and follow redirections (on body)</p>
        <pre><code>import requests

url = 'https://finger-warmup.chals.damctf.xyz/'

res = requests.get(url)
print(res.content)
print(res.headers)

while True:
    next = res.content.split(b'"')[1].decode('ascii')
    if not next:
        break
    
    next = url + next
    print(next)
    res = requests.get(next)
    print(res.content)
    print(res.headers)
</code></pre>

<p>Python: subprocess calls</p>
<pre><code>
from PIL import Image, ImageChops
import os
import subprocess


def tryOpen(password):
    cmd = '7z -p{} x {}'.format(password, 'level_1.7z')
    print('Unzipping: {}'.format(cmd))
    res = subprocess.run([ cmd ], stdout=subprocess.PIPE, shell=True)
    print('{}'.format(res))

im1 = Image.open("level_0.png")
im2 = Image.open("lev3l_0.png")

#difference = ImageChops.difference(im1, im2)
#difference.save("difference.png")

pixoriginal = im1.load()
pixoriginal2 = im2.load()


#pixdata = difference.load()
width, height = im1.size

for y in range(height):
    for x in range(width):				
        if pixoriginal[x,y] != pixoriginal2[x,y]:            
            #print('Difference X:{} Y:{}, Pixel: {}'.format(x,y, pixdata[x,y]))
            print('X:{} Y:{}, Pixel: {}'.format(x,y, pixoriginal[x,y]))
            print('X:{} Y:{}, Pixel: {}'.format(x,y, pixoriginal2[x,y]))
                        
            r1, g1, b1 = pixoriginal[x,y]
            r2, g2, b2 = pixoriginal2[x,y]
            xy = str(x) + ':' + str(y)
            rgb1 = '{:0{}X}'.format(r1, 2) + '{:0{}X}'.format(g1, 2) + '{:0{}X}'.format(b1, 2)
            rgb2 = '{:0{}X}'.format(r2, 2) + '{:0{}X}'.format(g2, 2) + '{:0{}X}'.format(b2, 2)
            print(xy + '+' + rgb1 + '+' + rgb2)
            tryOpen(xy + '+' + rgb1 + '+' + rgb2)
            
            r1, g1, b1 = pixoriginal2[x,y]
            r2, g2, b2 = pixoriginal[x,y]

            xy = str(x) + ':' + str(y)
            rgb1 = '{:0{}X}'.format(r1, 2) + '{:0{}X}'.format(g1, 2) + '{:0{}X}'.format(b1, 2)
            rgb2 = '{:0{}X}'.format(r2, 2) + '{:0{}X}'.format(g2, 2) + '{:0{}X}'.format(b2, 2)
            print(xy + '+' + rgb1 + '+' + rgb2)
            tryOpen(xy + '+' + rgb1 + '+' + rgb2)
</code></pre>


<p>Python: compile languages</p>
<pre><code>
import zxing
import os
import subprocess

import subprocess

while True:

    result = subprocess.run(['ls *.png'], stdout=subprocess.PIPE, shell=True)
    currentImage = result.stdout.strip().split(b'\n')[0].decode('ascii')

    print(currentImage)
    zip = currentImage.replace('.png', '.zip')
    print(zip)

    reader = zxing.BarCodeReader()
    barcodes = reader.decode(currentImage)
    print(barcodes.raw)

    with open('aux', 'w+') as f:
        f.write(barcodes.raw)


    if '<?php' in barcodes.raw:
        print('PHP?')
        res = subprocess.run(['php aux > aux.pwd'], stdout=subprocess.PIPE, shell=True)    
        res = res.stdout.strip().decode('ascii')
    elif 'print(' in barcodes.raw:
        print('python')
        res = subprocess.run(['python3 aux > aux.pwd'], stdout=subprocess.PIPE, shell=True)
        res = res.stdout.strip().decode('ascii')
    elif 'console.log' in barcodes.raw:
        print('javascript')
        res = subprocess.run(['node aux > aux.pwd'], stdout=subprocess.PIPE, shell=True)    
        res = res.stdout.strip().decode('ascii')
    elif 'public static void main'  in barcodes.raw:
        print('Java')
        res = subprocess.run(['mv aux Main.java'], stdout=subprocess.PIPE, shell=True)    
        res = subprocess.run(['javac Main.java'], stdout=subprocess.PIPE, shell=True)    
        res = subprocess.run(['java Main > aux.pwd'], stdout=subprocess.PIPE, shell=True)    
    elif 'fi;' in barcodes.raw:
        print('bash')
        res = subprocess.run(['bash aux > aux.pwd'], stdout=subprocess.PIPE, shell=True)    
    elif '++++' in barcodes.raw:
        res = subprocess.run(['./a.out aux > aux.pwd'], stdout=subprocess.PIPE, shell=True)    
    else:
        print('NO FUCKING CLUE')
        res = subprocess.run(['cat "" > aux.pwd'], stdout=subprocess.PIPE, shell=True)    

    passwd = ''
    with open('aux.pwd', 'r') as p:
        for line in p:
            passwd = line.strip()

    if passwd != '':
        cmd = '7z -p{} x {}'.format(passwd, zip)
        print('Unzipping: {}'.format(cmd))
        res = subprocess.run([ cmd ], stdout=subprocess.PIPE, shell=True)
        print('{}'.format(res))
        cmd = 'mv {} {}.processed'.format(currentImage, currentImage)
        result = subprocess.run([cmd], stdout=subprocess.PIPE, shell=True)
    else:
        print('Needs to look at this crap again, something fucked up showed up')
</code></pre>


<p>Extract file from wireshark stream</p>
<pre>
1 - Find TCP stream 67
2 - Follow TCP stream
3 - Show and save data as "RAW"
4 - Get rid of the HTTP header so the raw data starts with 7f454c46020101 which is the ELF file header
5 - Save as "damyoustupidchallenge.txt"
6 - xxd -r -p damyoustupidchallenge.txt > elffile
</pre>

</div>

<!-- Optional JavaScript -->
<!-- jQuery first, then Popper.js, then Bootstrap JS -->
<script src="https://code.jquery.com/jquery-3.2.1.slim.min.js" integrity="sha384-KJ3o2DKtIkvYIK3UENzmM7KCkRr/rE9/Qpg6aAZGJwFDMVNA/GpGFF93hXpG5KkN" crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.12.9/umd/popper.min.js" integrity="sha384-ApNbgh9B+Y1QKtv3Rn7W3mgPxhU9K/ScQsAP7hUibX39j7fakFPskvXusvfa0b4Q" crossorigin="anonymous"></script>
<script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/js/bootstrap.min.js" integrity="sha384-JZR6Spejh4U02d8jOt6vLEHfe/JQGiRRSQQxSfFWpi1MquVdAyjUar5+76PVCmYl" crossorigin="anonymous"></script>
</body>
</html>